var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];$(document).ready(function(){$(document).click(function(e){$("#streetsToggle").removeClass("highlited"),$("#issuesToggle").removeClass("highlited")}),$(".custom-combobox").click(function(e){$(".custom-combobox").removeClass("highlited")}),$("#streetsToggle").click(function(e){$("#sidebar").addClass("open"),$("#main").addClass("open"),$("#home").addClass("open"),$("#streets").addClass("open"),$("#issues").removeClass("open")}),$("#issuesToggle").click(function(e){$("#sidebar").addClass("open"),$("#main").addClass("open"),$("#home").addClass("open"),$("#issues").addClass("open"),$("#streets").removeClass("open")}),$(".collapse").click(function(e){$("#sidebar").removeClass("open"),$("#main").removeClass("open"),$("#home").removeClass("open")}),$(".aboutLink").click(function(e){$("#home").hide(),$(".page").hide(),$("#aboutPage").show()}),$(".helpLink").click(function(e){$("#home").hide(),$(".page").hide(),$("#helpPage").show()}),$(".feedbackLink").click(function(e){$("#home").hide(),$(".page").hide(),$("#feedbackPage").show()}),$(".back").click(function(e){$(".page").hide(),$("#home").show()})});var cm;$(document).ready(function(){function e(){var e=this;e.requestTypes=ko.observable(),e.chosenRequestTypeName=ko.observable(),e.chosenRequestTypeId=ko.observable(),e.clusters=ko.observable(!0),e.streets=ko.observable(!1),e.chosenStreetName=ko.observable(),e.chosenStreetStats=ko.observable(),e.mapMode=ko.observable("clusterMap"),e.issues=ko.observable(!1),e.chosenCluster=ko.observable(),e.batch=ko.observable(),e.loading=ko.observable(!1),e.lastUpdated=ko.computed(function(){return"undefined"!=typeof e.batch()?(d.setMonth(d.getMonth()+1),d.getMonth()+"-"+d.getDate()+"-"+d.getFullYear()):!1}),e.getRequestTypeMenu=function(){e.loading(!0),$.get("/request_type_menu",function(s){e.requestTypes(s.requestTypes),e.loading(!1)})},e.getData=function(s){$("#map").css("background","none"),e.loading(!0),e.clusters(!0),e.chosenRequestTypeId(s),initMap(),clearMap(),e.issues(!1),e.mapMode("clusterMap"),$.get("/streets/ranking/"+s,function(t){e.streets(t.streets),$.get("/clusters/get_clusters/"+s,function(t){e.clusters(t.clusters),e.batch(t.batch),0==t.clusters.length?(e.clusters(!1),e.loading(!1)):(cluster_counts=plotClusterMap(t.clusters),$.get("/issues/get_issues/"+s,function(s){plotHeatMap(s.issues,cluster_counts),e.loading(!1),$("#streetsToggle").addClass("highlited")}))})})},e.goToCluster=function(s){e.loading(!0),e.chosenCluster(s),$.get("/issues/get_cluster/"+s.id_,function(s){e.issues(s.issues.map(function(e){var s=new Date(e.created_at);return e.month=monthNames[s.getMonth()],e.year=s.getFullYear(),e})),plotIssuesMap(s.issues),e.loading(!1),$("#issuesToggle").addClass("highlited")})},e.goToStreetPage=function(s){e.loading(!0),e.chosenStreetName(s.name),$.get("/streets/stats/"+s.id_,function(s){e.chosenStreetStats(s.stats),$("#home").hide(),$("#streetPage").show(),e.loading(!1)})},$("#mapToggle").click(function(s){e.mapMode("heatMap"==e.mapMode()?"clusterMap":"heatMap"),$("#mapToggle").toggleClass("heatmap"),heatMap&&heatMap.setMap(heatMap.getMap()?null:map),heatMap&&("map_style"==map.getMapTypeId()?map.setMapTypeId(google.maps.MapTypeId.ROADMAP):map.setMapTypeId("map_style")),clusterMap&&clusterMap.setMap(clusterMap.getMap()?null:map),issueMap&&issueMap.setMap(issueMap.getMap()?null:map)}),e.asdfg=function(e){console.log("asdfg"),console.log(e)},e.highliteIssue=function(e){console.log("asdf"),document.getElementById("issueIcon_"+e.id_).style.background="red"},e.unhighliteIssue=function(e){document.getElementById("issueIcon_"+e.id_).style.background="none"},$("#issuesFooter").click(function(s){title="Scastrap_issues_",title+e.chosenRequestTypeName(),title+="_"+e.lastUpdated()+".csv",title+="_cluster_id#"+e.chosenCluster().id_+".csv",exportIssues(e.issues(),title)}),$("#streetsFooter").click(function(s){title="Scastrap_street_ranking_",title+=e.chosenRequestTypeName(),title+="_"+e.lastUpdated()+".csv",exportStreets(e.streets(),title)}),$("#combobox").change(function(s){e.chosenRequestTypeName($("option:selected").text()),e.getData($("#combobox").val())}),e.getRequestTypeMenu()}cm=new e,ko.applyBindings(cm)});